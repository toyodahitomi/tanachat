<!DOCTYPE html>
<html lang="ja">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>chatApp</title>
  <link rel="stylesheet" href="css/sample.css">
  <style>
    #output li {
      background: #ccc;
    }
  </style>

</head>

<body>
  <link href="https://fonts.googleapis.com/earlyaccess/nicomoji.css" rel="stylesheet">
  <div class="title_box">
    <h1>ãŸãªã¹ã•ã‚“ã¨ãŠã—ã‚ƒã¹ã‚Š</h1>
  </div>
  <!-- å…¥åŠ›å ´æ‰€ã‚’ä½œæˆã—ã‚ˆã† -->

  <div class="form_box">
    <form>
      <fieldset>
        <p>
          <legend>ãƒãƒ£ãƒƒãƒˆå…¥åŠ›ç”»é¢</legend>
        </p>
        <div class="your_name">
          åå‰: <input type=" text" id="name" size="23">
        </div>
        <div class="your_text">
          ãŸãªã¹ã•ã‚“ã«<br>
          è¨€ã„ãŸã„ã“ã¨: <input type="text" id="text" size="23">
        </div>
        <div class="button_box">
          <button type="button" id="send1">send</button>
        </div>

        <div class="tanabesan_answer_area">
          ãŸãªã¹ã•ã‚“ã®<br>
          ãŠè¿”äº‹: <input type=" text" id="tanabesan_answer1" size="23">
        </div>

      </fieldset>
    </form>
  </div>



  <!-- ãƒ‡ãƒ¼ã‚¿å‡ºåŠ›å ´æ‰€ -->

  <ul id="output"></ul>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
  <script>
    // æ—¥æ™‚ã‚’ã„ã„æ„Ÿã˜ã®å½¢å¼ã«ã™ã‚‹é–¢æ•°
    function convertTimestampToDatetime(timestamp) {
      const _d = timestamp ? new Date(timestamp * 1000) : new Date();
      const Y = _d.getFullYear();
      const m = (_d.getMonth() + 1).toString().padStart(2, '0');
      const d = _d.getDate().toString().padStart(2, '0');
      const H = _d.getHours().toString().padStart(2, '0');
      const i = _d.getMinutes().toString().padStart(2, '0');
      const s = _d.getSeconds().toString().padStart(2, '0');
      return `${Y}/${m}/${d} ${H}:${i}:${s}`;
    }
  </script>


  <!-- ä»¥ä¸‹ã«firebaseã®ã‚³ãƒ¼ãƒ‰ã‚’è²¼ã‚Šä»˜ã‘ã‚ˆã† -->

  <!--  ãƒ–ãƒ©ã‚¦ã‚¶ã§ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’å‹•ä½œã•ã›ã¾ã™ã‚ˆï½   -->
  <script type="module">

    //ï¼‘ï¼firebaseã¨ã‚„ã‚Šå–ã‚Šã§ãã‚‹ã‚ˆã†ã«ãªã‚‹ã‚³ãƒ¼ãƒ‰ã‚’è²¼ã‚Šä»˜ã‘ãŸ
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.5.0/firebase-app.js";


    import {
      //ï¼’-1ï¼ã„ã‚ã„ã‚ãªæ©Ÿèƒ½ãŒä½¿ãˆã‚‹ã‚ˆã†ã«ã€æœ€åˆã«èª­ã¿è¾¼ã‚“ã§ãŠãã®ã ã
      getFirestore,
      collection,
      addDoc,
      //2-2. ã“ã“ã§ã‚µãƒ¼ãƒãƒ¼ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ã‚’èª­ã¿è¾¼ã‚“ã§ã‚‹ã‹ã‚‰ã€ä¸‹ã®ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒå…¥åŠ›ã—ãŸãƒ‡ãƒ¼ã‚¿ã‚’dbã‹ã‚‰èª­ã¿è¾¼ã‚€ã¨ãã«äººé–“ã«èª­ã¿ã‚„ã™ã„ã‚ˆã†ã«èª­ã¿è¾¼ã‚“ã§æ¥ã‚‰ã‚Œã‚‹ã£ã¦ã‚ã‘
      serverTimestamp,
      //2-3. ãƒ‡ãƒ¼ã‚¿ã‚’å–ã£ã¦ãã¾ã™ã‚ˆãƒ¼ã®å‡¦ç†ã€ãƒ‡ãƒ¼ã‚¿ãŒè¿½åŠ ã•ã‚ŒãŸã‚Šã€ä¸Šæ›¸ãã•ã‚ŒãŸã‚Šã€å‰Šé™¤ã•ã‚ŒãŸã‚Šã—ãŸã‚¿ã‚¤ãƒŸãƒ³ã‚°ã«å¼·ã„onsnapshotãŒå–ã£ã¦ãã¾ã™
      onSnapshot,
      query,
      orderBy,
      //ç¾åœ¨9.5.0ã§ã‚ã‚‹ãŒã€ä»¥å‰ã®9.2.0ãŒæ·»ä»˜ã—ã¦ã‚ã£ãŸã®ã§ã€ãã®éƒ¨åˆ†ã‚’â†‘ã®Firestoreã«ã‚ã‚‹æœ€æ–°ã‚³ãƒ¼ãƒ‰ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã«åˆã‚ã›ã‚‹
    } from "https://www.gstatic.com/firebasejs/9.5.0/firebase-firestore.js";


    const firebaseConfig = {

      authDomain: "chat-44874.firebaseapp.com",
      projectId: "chat-44874",
      storageBucket: "chat-44874.appspot.com",
      messagingSenderId: "481419352739",
      appId: "1:481419352739:web:26f0dc15fdec70383d3d16"
    };

    //Firebaseã¨ã¤ãªãŒã‚Šã¾ã™ã‚ˆãƒ¼
    const app = initializeApp(firebaseConfig);
    //  è¿½åŠ ã€Firebaseã¨ã‚„ã‚Šã¨ã‚Šã™ã‚‹ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ï¼ˆdbï¼‰ã¨ã¤ãªãŒã‚Šã¾ã™ã‚ˆãƒ¼ã€ã®ã‚³ãƒ¼ãƒ‰
    const db = getFirestore(app);
    //é€ä¿¡ãƒœã‚¿ãƒ³ã€Œsendã€ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ãŸã‚‰ã€ãªã‚“ã‹ã—ã¾ã™ã‚ˆãƒ¼ã€ã®ã‚³ãƒ¼ãƒ‰
    $("#send1").on("click", function () {
      //ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒå…¥åŠ›ã—ãŸãƒ‡ãƒ¼ã‚¿ã‚’å–ã£ã¦ãã‚‹ã€idã‚’ä½¿ã£ã¦.val(),ã‚’ä½¿ã£ã¦èª­ã¿è¾¼ã‚€ã‚„ã¤ã€‚ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã§1å€‹ã«ã¾ã¨ã‚ã‚‹ã‚„ã¤ã­ã€‚
      const data = {
        //ãƒãƒ¼ãƒ ã¨ãƒ†ã‚­ã‚¹ãƒˆã¯ä»Šã¾ã§ã¨åŒã˜æ‰‹å£ã€‚idã‚’æŒ‡å®šã—ã¦ãƒ‰ãƒƒãƒˆãƒãƒ«ï¼ˆï¼‰ã‚«ãƒ³ãƒã€‚
        name: $("#name").val(),
        text: $("#text").val(),

        //ã‚°ãƒ¼ã‚°ãƒ«å…ˆç”Ÿç‹¬è‡ªã®ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ã‚’ã©ã†ã‚„ã£ã¦è¡¨ç¤ºã™ã‚‹ã‹ã¨ã„ã†ã¨ä¸‹ã®ã€Œã‚µãƒ¼ãƒãƒ¼ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ã€ã‚’æŒ‡å®šã—ã¦ã‚ã’ã‚‹ã¨èª­ã¿è¾¼ã¿ãŒã§ãã‚‹ã‚ˆã†ã«ãªã‚‹ã‚ˆã€‚
        time: serverTimestamp(),


      };
      //é€ä¿¡ã‚¯ãƒªãƒƒã‚¯ã‚’ã—ãŸã‚‰ä¸‹ã®ãƒ©ãƒ³ãƒ€ãƒ ãªãŠè¿”äº‹ãŒè¡¨ç¤ºæ¬„ã«å‡ºã‚‹ã‚ˆã†ã«ã—ãŸã„
      $("#send1").on("click", function () {

        //ãŸãªã¹ã•ã‚“ã®è¿”äº‹ã‚’ãƒ©ãƒ³ãƒ€ãƒ ã«ä½œã‚‹
        const text01 = ["ã¾ã‚ã­ã‡ï½", "ã†ãµãµ", "ã°ã‹ãƒ¼ãƒ¼ãƒ¼ï¼", "ã™ã¿ã¾ã›ã‚“ãƒ»ãƒ»ãƒ»", "ã“ã®ã‚¹ã‚¤ãƒ¼ãƒ„è¶…ç¾å‘³ã—ã„ã‚“ã ã‘ã©ï¼", "äº€æ¢¨å›ã«ä¼šã„ãŸãƒ¼ã„ï¼"];
        const randomtext = Math.floor(Math.random() * text01.length);
        const tanabe_text = text01[randomtext];
        console.log(tanabe_text);
        //$("#tanabesan_answer1").text(tanabe_text),





        //å®Ÿéš›ãƒ‡ãƒ¼ã‚¿ã‚’å–ã£ã¦ãã‚‹ã®ã¯ä¸‹ã®ä¸€è¡Œã§å®Œäº†ã€‚ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã€ï¼ˆï¼‰ã€ä¸­ã«ã‚«ãƒ³ãƒã€å·¦ã€å³ã€‚ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã«ä¿å­˜ã—ã¾ã™ã€é€£æºã—ã¦ã„ã‚‹dbã«ã—ã¾ã™ã€ã¤ãªãŒã£ã¦ã„ã‚‹ã€Œãƒãƒ£ãƒƒãƒˆã€ã¨ã„ã†ã¨ã“ã‚ã«å…¥ã‚ŒãŸã„ã§ã™ã€‚ä½•ã‚’å…¥ã‚Œã¾ã™ã‹ï¼Ÿä¸Šã§ä½œã£ãŸdataã®å†…å®¹ã§ã™ã€‚
        addDoc(collection(db, "chat"), data);
        //ãƒ†ã‚­ã‚¹ãƒˆã‚’è¡¨ç¤ºã—ãŸã‚‰ã€ã‹ã£ã“ã®ä¸­ã‚’ç©ºã«ã—ã¦ã­ã€‚
        $("#text").val("");


      });

      const q = query(collection(db, "chat"), orderBy("time", "desc"));
      // ãƒ‡ãƒ¼ã‚¿å–å¾—å‡¦ç†
      onSnapshot(q, (querySnapshot) => {
        //ä¸‹ã®ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ãƒ­ã‚°ã§0ç•ªç›®ã®ãƒ‡ãƒ¼ã‚¿ã‚’ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã«å‡ºã›ã‚‹ã€ãƒ‰ãƒƒãƒˆãƒ‡ãƒ¼ã‚¿ï¼ˆï¼‰ã§è¡Œã‘ã‚‹ã‚ˆã†ã«ã‚°ãƒ¼ã‚°ãƒ«å…ˆç”ŸãŒä½œã£ã¦ãã‚ŒãŸ   
        //console.log(querySnapshot.docs[0].data());
        //ä¸‹ã®ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ãƒ­ã‚°ã§0ç•ªç›®ã®idã‚’ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã«å‡ºã›ã‚‹ã€ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãªã®ã§.idã§OK
        //console.log(querySnapshot.docs[0].id);
        //});
        //ã¨ã¯ã„ãˆã€1ã¤1ã¤ä¸Šã®å‡¦ç†ã‚’ã™ã‚‹ã®ã¯ãã¤ã„ã®ã§ã€ä¸‹ã«ã„ã„æ„Ÿã˜ã«ãƒ‡ãƒ¼ã‚¿ã‚’å–ã£ã¦ãã¦ãã‚Œã‚‹é…åˆ—ã¨ç¹°ã‚Šè¿”ã—å‡¦ç†æœ‰
        //2-1 ç©ºã®é…åˆ—ã‚’ç”¨æ„ã™ã‚‹
        const dataArray = [];
        //2-2 querySnapshot.docsã¨ã„ã†é…åˆ—ã«å¯¾ã—ã¦forEachã¨ã„ã†ç¹°ã‚Šè¿”ã—å‡¦ç†ã‚’è¡Œã†ã€‚forã§ã‚‚OKã€‚
        querySnapshot.docs.forEach(function (doc) {
          //ãã‚Œãã‚Œ1å€‹ãšã¤å–ã‚Šå‡ºã—ã¦ããŸã¨ã“ã‚ã‹ã‚‰ã€idã¨dataãŒã¾ã¨ã¾ã£ãŸã²ã¨ã¤ã®ã‹ãŸã¾ã‚Šã‚’å‘¼ã³å‡ºã—ã¾ã™

          const data = {
            id: doc.id,
            data: doc.data(),
          };
          //ã‚ˆã³ã ã—ãŸã‹ãŸã¾ã‚Šã‚’æœ€åˆã®ç©ºã®é…åˆ—ã«ã©ã‚“ã©ã‚“å…¥ã‚Œã¦ã„ãã¾ã™
          dataArray.push(data);

        });

        console.log(dataArray);

        const tagArray = [];
        dataArray.forEach(function (data) {
          tagArray.push(`
     <li id="${data.id}">
        <p>${data.data.name}  ${convertTimestampToDatetime(data.data.time.seconds)}</p>
        <p>${data.data.text} </p>
      </li>
       `);
        });

        $("#output").html(tagArray);

        <script type="module">
  // Import the functions you need from the SDKs you need
          import {initializeApp} from "https://www.gstatic.com/firebasejs/9.5.0/firebase-app.js";
          // TODO: Add SDKs for Firebase products that you want to use
          // https://firebase.google.com/docs/web/setup#available-libraries

          // Your web app's Firebase configuration
          const firebaseConfig = {

            authDomain: "tanabesan-answer.firebaseapp.com",
          projectId: "tanabesan-answer",
          storageBucket: "tanabesan-answer.appspot.com",
          messagingSenderId: "790938728196",
          appId: "1:790938728196:web:5e11da3524ef7d7541c251"
      };

          // Initialize Firebase
          const app = initializeApp(firebaseConfig);

          import {initializeApp} from "https://www.gstatic.com/firebasejs/9.5.0/firebase-app.js";

          // ğŸ”½ è¿½åŠ  / `9.2.0`ã®éƒ¨åˆ†ã‚’â†‘ã®Firestoreã‹ã‚‰è²¼ã‚Šä»˜ã‘ãŸã‚³ãƒ¼ãƒ‰ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã«åˆã‚ã›ã‚‹
          import {
            getFirestore,
            collection,
            addDoc,
            serverTimestamp,
} from "https://www.gstatic.com/firebasejs/9.2.0/firebase-firestore.js";

          const firebaseConfig = {
            // çœç•¥
          };

          const app = initializeApp(firebaseConfig);

          // ğŸ”½ è¿½åŠ 
          const db = getFirestore(app);
  </script>










  //const washingtonRef = doc(db, "ã‚³ãƒ³ã‚½ãƒ¼ãƒ«å", "ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆå")ã§ç‰¹å®šã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã«æƒ…å ±ã‚’è¿½åŠ ã—ãŸã‚Šã€æ›´æ–°ã§ãã‚‹ã¨æ€ã„ã¾ã™ï¼ 0





  });
  });

  </script>

</body>

</html>